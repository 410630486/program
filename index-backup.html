<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校務系統網站</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Toast 容器 -->
    <div id="toast-container" class="position-fixed top-0 end-0 p-3" style="z-index: 11"></div>

    <header>
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="#" onclick="showSection('home')">
                    <i class="bi bi-mortarboard me-2"></i>校務系統網站
                </a>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto" id="navMenu">
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('home')">
                                <i class="bi bi-house me-1"></i>首頁
                            </a>
                        </li>
                        <li class="nav-item" id="nav-student" style="display: none;">
                            <a class="nav-link" href="#" onclick="showSection('student')">
                                <i class="bi bi-person me-1"></i>學生專區
                            </a>
                        </li>
                        <li class="nav-item" id="nav-staff" style="display: none;">
                            <a class="nav-link" href="#" onclick="showSection('staff')">
                                <i class="bi bi-person-badge me-1"></i>教職員專區
                            </a>
                        </li>
                        <li class="nav-item" id="nav-backend" style="display: none;">
                            <a class="nav-link" href="#" onclick="showSection('backend')">
                                <i class="bi bi-gear me-1"></i>教職員後台
                            </a>
                        </li>
                        <li class="nav-item" id="nav-hr" style="display: none;">
                            <a class="nav-link" href="#" onclick="showSection('hr')">
                                <i class="bi bi-people me-1"></i>人事部
                            </a>
                        </li>
                        <li class="nav-item" id="nav-admin" style="display: none;">
                            <a class="nav-link" href="#" onclick="showSection('admin')">
                                <i class="bi bi-shield-lock me-1"></i>系統管理
                            </a>
                        </li>
                    </ul>
                    
                    <div class="navbar-nav">
                        <button class="btn btn-outline-light" onclick="showLoginModal()">
                            <i class="bi bi-box-arrow-in-right me-1"></i>登入
                        </button>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mt-4">
        <!-- 首頁 -->
        <section id="home" class="content-section">
            <div class="row">
                <div class="col-12">
                    <div class="jumbotron bg-primary text-white p-5 rounded">
                        <h1 class="display-4">歡迎使用校務系統</h1>
                        <p class="lead">提供學生、教職員、人事部與系統管理的完整解決方案</p>
                        <hr class="my-4">
                        <p>請先登入以使用相關功能</p>
                        <button class="btn btn-light btn-lg" onclick="showLoginModal()">
                            <i class="bi bi-box-arrow-in-right me-2"></i>立即登入
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 學生專區 -->
        <section id="student" class="content-section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h2 class="mb-4"><i class="bi bi-person text-primary me-2"></i>學生專區</h2>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('student-info')">
                        <div class="card-body text-center">
                            <i class="bi bi-person-vcard display-4 text-primary mb-3"></i>
                            <h5 class="card-title">基本資料查詢</h5>
                            <p class="card-text">查詢個人基本資料</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('student-schedule')">
                        <div class="card-body text-center">
                            <i class="bi bi-calendar-week display-4 text-primary mb-3"></i>
                            <h5 class="card-title">課表查詢</h5>
                            <p class="card-text">查詢個人課程表</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('student-grades')">
                        <div class="card-body text-center">
                            <i class="bi bi-trophy display-4 text-primary mb-3"></i>
                            <h5 class="card-title">成績查詢</h5>
                            <p class="card-text">查詢個人成績</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('student-enrollment')">
                        <div class="card-body text-center">
                            <i class="bi bi-pencil-square display-4 text-primary mb-3"></i>
                            <h5 class="card-title">選課登記</h5>
                            <p class="card-text">進行選課登記作業</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('student-fees')">
                        <div class="card-body text-center">
                            <i class="bi bi-credit-card display-4 text-primary mb-3"></i>
                            <h5 class="card-title">學費查詢</h5>
                            <p class="card-text">查詢學費繳費狀況</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('student-activities')">
                        <div class="card-body text-center">
                            <i class="bi bi-calendar-event display-4 text-primary mb-3"></i>
                            <h5 class="card-title">活動報名</h5>
                            <p class="card-text">查詢與報名校園活動</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('student-announcements')">
                        <div class="card-body text-center">
                            <i class="bi bi-megaphone display-4 text-primary mb-3"></i>
                            <h5 class="card-title">公告通知</h5>
                            <p class="card-text">查詢學校公告與通知</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('student-documents')">
                        <div class="card-body text-center">
                            <i class="bi bi-file-earmark-text display-4 text-primary mb-3"></i>
                            <h5 class="card-title">文件申請</h5>
                            <p class="card-text">申請各種證明文件</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('student-library')">
                        <div class="card-body text-center">
                            <i class="bi bi-book display-4 text-primary mb-3"></i>
                            <h5 class="card-title">圖書館系統</h5>
                            <p class="card-text">查詢圖書借閱記錄</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('student-feedback')">
                        <div class="card-body text-center">
                            <i class="bi bi-chat-square-text display-4 text-primary mb-3"></i>
                            <h5 class="card-title">意見反映</h5>
                            <p class="card-text">提交意見與建議</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 教職員專區 -->
        <section id="staff" class="content-section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h2 class="mb-4"><i class="bi bi-person-badge text-primary me-2"></i>教職員專區</h2>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('staff-info')">
                        <div class="card-body text-center">
                            <i class="bi bi-person-vcard display-4 text-warning mb-3"></i>
                            <h5 class="card-title">基本資料查詢</h5>
                            <p class="card-text">查詢個人基本資料</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('staff-grades')">
                        <div class="card-body text-center">
                            <i class="bi bi-clipboard-data display-4 text-warning mb-3"></i>
                            <h5 class="card-title">成績登錄</h5>
                            <p class="card-text">登錄學生成績</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('staff-schedule')">
                        <div class="card-body text-center">
                            <i class="bi bi-calendar-week display-4 text-warning mb-3"></i>
                            <h5 class="card-title">授課課表</h5>
                            <p class="card-text">查詢授課課表</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('staff-finance')">
                        <div class="card-body text-center">
                            <i class="bi bi-currency-dollar display-4 text-warning mb-3"></i>
                            <h5 class="card-title">財務紀錄</h5>
                            <p class="card-text">查詢薪資與財務記錄</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('staff-activities')">
                        <div class="card-body text-center">
                            <i class="bi bi-calendar-event display-4 text-warning mb-3"></i>
                            <h5 class="card-title">活動報名</h5>
                            <p class="card-text">教職員活動報名</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('staff-research')">
                        <div class="card-body text-center">
                            <i class="bi bi-journal-text display-4 text-warning mb-3"></i>
                            <h5 class="card-title">研究計畫</h5>
                            <p class="card-text">研究計畫申請與管理</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('staff-office-hours')">
                        <div class="card-body text-center">
                            <i class="bi bi-clock-history display-4 text-warning mb-3"></i>
                            <h5 class="card-title">Office Hours</h5>
                            <p class="card-text">設定與查詢面談時間</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('staff-resources')">
                        <div class="card-body text-center">
                            <i class="bi bi-box-seam display-4 text-warning mb-3"></i>
                            <h5 class="card-title">資源申請</h5>
                            <p class="card-text">申請教學設備與資源</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 教職員後台 -->
        <section id="backend" class="content-section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h2 class="mb-4"><i class="bi bi-gear text-primary me-2"></i>教職員後台</h2>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('backend-students')">
                        <div class="card-body text-center">
                            <i class="bi bi-search display-4 text-info mb-3"></i>
                            <h5 class="card-title">學生資料查詢</h5>
                            <p class="card-text">查詢學生資料</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('backend-courses')">
                        <div class="card-body text-center">
                            <i class="bi bi-book display-4 text-info mb-3"></i>
                            <h5 class="card-title">課程管理</h5>
                            <p class="card-text">建立課程與排課</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('backend-stats')">
                        <div class="card-body text-center">
                            <i class="bi bi-bar-chart display-4 text-info mb-3"></i>
                            <h5 class="card-title">成績統計</h5>
                            <p class="card-text">班級成績統計</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('backend-student-edit')">
                        <div class="card-body text-center">
                            <i class="bi bi-person-gear display-4 text-info mb-3"></i>
                            <h5 class="card-title">學生資料異動</h5>
                            <p class="card-text">修改學生基本資料</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('backend-ranking')">
                        <div class="card-body text-center">
                            <i class="bi bi-trophy display-4 text-info mb-3"></i>
                            <h5 class="card-title">全校排名</h5>
                            <p class="card-text">查詢全校學生排名</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('backend-reports')">
                        <div class="card-body text-center">
                            <i class="bi bi-file-earmark-bar-graph display-4 text-info mb-3"></i>
                            <h5 class="card-title">統計報表</h5>
                            <p class="card-text">生成各類統計報表</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('backend-enrollment')">
                        <div class="card-body text-center">
                            <i class="bi bi-clipboard-check display-4 text-info mb-3"></i>
                            <h5 class="card-title">選課管理</h5>
                            <p class="card-text">管理學生選課狀況</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 人事部 -->
        <section id="hr" class="content-section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h2 class="mb-4"><i class="bi bi-people text-primary me-2"></i>人事部</h2>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('hr-staff')">
                        <div class="card-body text-center">
                            <i class="bi bi-person-lines-fill display-4 text-success mb-3"></i>
                            <h5 class="card-title">教職員資料</h5>
                            <p class="card-text">查詢教職員資料</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('hr-attendance')">
                        <div class="card-body text-center">
                            <i class="bi bi-clock display-4 text-success mb-3"></i>
                            <h5 class="card-title">出勤管理</h5>
                            <p class="card-text">出缺勤與加班登記</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('hr-calendar')">
                        <div class="card-body text-center">
                            <i class="bi bi-calendar-check display-4 text-success mb-3"></i>
                            <h5 class="card-title">行事曆</h5>
                            <p class="card-text">行事曆與考績查詢</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('hr-announcements')">
                        <div class="card-body text-center">
                            <i class="bi bi-megaphone display-4 text-success mb-3"></i>
                            <h5 class="card-title">公告發布</h5>
                            <p class="card-text">發布人事相關公告</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('hr-recruitment')">
                        <div class="card-body text-center">
                            <i class="bi bi-person-plus display-4 text-success mb-3"></i>
                            <h5 class="card-title">招聘管理</h5>
                            <p class="card-text">管理招聘流程與面試</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('hr-training')">
                        <div class="card-body text-center">
                            <i class="bi bi-book-half display-4 text-success mb-3"></i>
                            <h5 class="card-title">教育訓練</h5>
                            <p class="card-text">規劃與管理教育訓練</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('hr-performance')">
                        <div class="card-body text-center">
                            <i class="bi bi-award display-4 text-success mb-3"></i>
                            <h5 class="card-title">績效考核</h5>
                            <p class="card-text">管理員工績效評估</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('hr-payroll')">
                        <div class="card-body text-center">
                            <i class="bi bi-cash-coin display-4 text-success mb-3"></i>
                            <h5 class="card-title">薪資管理</h5>
                            <p class="card-text">管理薪資與福利</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 系統管理 -->
        <section id="admin" class="content-section" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <h2 class="mb-4"><i class="bi bi-shield-lock text-primary me-2"></i>系統管理</h2>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('admin-users')">
                        <div class="card-body text-center">
                            <i class="bi bi-people-fill display-4 text-danger mb-3"></i>
                            <h5 class="card-title">使用者管理</h5>
                            <p class="card-text">管理系統使用者帳號</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('admin-backup')">
                        <div class="card-body text-center">
                            <i class="bi bi-cloud-arrow-down display-4 text-danger mb-3"></i>
                            <h5 class="card-title">系統備份</h5>
                            <p class="card-text">執行系統備份與還原</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('admin-logs')">
                        <div class="card-body text-center">
                            <i class="bi bi-file-text display-4 text-danger mb-3"></i>
                            <h5 class="card-title">系統日誌</h5>
                            <p class="card-text">查看系統操作記錄</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('admin-roles')">
                        <div class="card-body text-center">
                            <i class="bi bi-person-badge display-4 text-danger mb-3"></i>
                            <h5 class="card-title">角色權限</h5>
                            <p class="card-text">管理角色與權限設定</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('admin-security')">
                        <div class="card-body text-center">
                            <i class="bi bi-shield-check display-4 text-danger mb-3"></i>
                            <h5 class="card-title">安全設定</h5>
                            <p class="card-text">密碼規則與雙重驗證</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('admin-maintenance')">
                        <div class="card-body text-center">
                            <i class="bi bi-tools display-4 text-danger mb-3"></i>
                            <h5 class="card-title">系統維護</h5>
                            <p class="card-text">系統停機與重啟操作</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('admin-monitoring')">
                        <div class="card-body text-center">
                            <i class="bi bi-activity display-4 text-danger mb-3"></i>
                            <h5 class="card-title">系統監控</h5>
                            <p class="card-text">監控系統效能與狀態</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card h-100 function-card" onclick="showFeature('admin-database')">
                        <div class="card-body text-center">
                            <i class="bi bi-database display-4 text-danger mb-3"></i>
                            <h5 class="card-title">資料庫管理</h5>
                            <p class="card-text">資料庫維護與優化</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 功能內容顯示區 -->
        <section id="feature-content" class="content-section mt-5" style="display: none;">
            <div class="card">
                <div class="card-body" id="dynamic-content">
                    <!-- 動態內容在這裡 -->
                </div>
            </div>
        </section>
    </main>

    <!-- 登入模態框 -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">使用者登入</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="username" class="form-label">使用者名稱</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">密碼</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="mb-3">
                            <label for="userType" class="form-label">身份</label>
                            <select class="form-select" id="userType" required>
                                <option value="">請選擇身份</option>
                                <option value="student">學生</option>
                                <option value="staff">教職員</option>
                                <option value="hr">人事部</option>
                                <option value="admin">系統管理員</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">登入</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // 等待DOM完全載入
        document.addEventListener('DOMContentLoaded', function() {
            // 使用者資料
            const users = {
                'admin': { password: 'admin123', userType: 'admin', name: '系統管理員' },
                'student001': { password: 'student123', userType: 'student', name: '王小明' },
                'teacher001': { password: 'teacher123', userType: 'staff', name: '陳老師' },
                'hr001': { password: 'hr123', userType: 'hr', name: '李人事' },
                'tku123': { password: '123456', userType: 'student', name: '新學生' }
            };

            // 權限設定
            const permissions = {
                'student': [
                    'student-info', 'student-schedule', 'student-grades', 'student-enrollment', 
                    'student-fees', 'student-activities', 'student-announcements', 'student-documents',
                    'student-library', 'student-feedback'
                ],
                'staff': [
                'staff-info', 'staff-grades', 'staff-schedule', 'staff-finance', 'staff-activities',
                'staff-research', 'staff-office-hours', 'staff-resources',
                'backend-students', 'backend-courses', 'backend-stats', 'backend-student-edit',
                'backend-ranking', 'backend-reports', 'backend-enrollment'
            ],
            'hr': [
                'hr-staff', 'hr-attendance', 'hr-calendar', 'hr-announcements',
                'hr-recruitment', 'hr-training', 'hr-performance', 'hr-payroll'
            ],
            'admin': [
                'admin-users', 'admin-backup', 'admin-logs', 'admin-roles',
                'admin-security', 'admin-maintenance', 'admin-monitoring', 'admin-database'
            ]
        };

        // 當前使用者
        let currentUser = null;

        // 顯示登入模態框
        function showLoginModal() {
            const modal = new bootstrap.Modal(document.getElementById('loginModal'));
            modal.show();
        }

        // 檢查是否有保存的登入狀態
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
            try {
                currentUser = JSON.parse(savedUser);
                updateUI();
            } catch (error) {
                console.error('解析用戶資料失敗:', error);
                localStorage.removeItem('currentUser');
            }
        }

        // 登入處理
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const userType = document.getElementById('userType').value;
                
                try {
                    const response = await fetch('/api/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            username: username,
                            password: password,
                        userType: userType
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    currentUser = {
                        username: result.user.username,
                        name: result.user.name,
                        userType: result.user.userType,
                        token: result.token
                    };
                    
                    // 儲存到 localStorage
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // 關閉模態框
                    bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
                    
                    // 更新介面
                    updateUI();
                    
                    // 顯示成功訊息
                    showToast('success', '登入成功', `歡迎 ${result.user.name}！`);
                    
                    // 清空表單
                    document.getElementById('loginForm').reset();
                } else {
                    showToast('danger', '登入失敗', result.message || '帳號、密碼或身份不正確');
                }
            } catch (error) {
                console.error('Login error:', error);
                showToast('danger', '登入失敗', '連接伺服器失敗');
            }
            });
        }

        // 更新使用者介面
        function updateUI() {
            const loginBtn = document.querySelector('.btn-outline-light');
            
            if (currentUser) {
                // 更新登入按鈕
                loginBtn.innerHTML = `<i class="bi bi-person-check me-1"></i>${currentUser.name}`;
                loginBtn.onclick = logout;
                
                // 顯示對應的導覽選項
                updateNavigation();
            } else {
                // 重設登入按鈕
                loginBtn.innerHTML = '<i class="bi bi-box-arrow-in-right me-1"></i>登入';
                loginBtn.onclick = showLoginModal;
                
                // 隱藏所有導覽選項
                hideAllNavigation();
            }
        }

        // 更新導覽列
        function updateNavigation() {
            // 隱藏所有導覽選項
            hideAllNavigation();
            
            // 根據使用者類型顯示對應選項
            if (currentUser.userType === 'student') {
                document.getElementById('nav-student').style.display = 'block';
            } else if (currentUser.userType === 'staff') {
                document.getElementById('nav-staff').style.display = 'block';
                document.getElementById('nav-backend').style.display = 'block';
            } else if (currentUser.userType === 'hr') {
                document.getElementById('nav-hr').style.display = 'block';
            } else if (currentUser.userType === 'admin') {
                document.getElementById('nav-admin').style.display = 'block';
            }
        }

        // 隱藏所有導覽選項
        function hideAllNavigation() {
            document.getElementById('nav-student').style.display = 'none';
            document.getElementById('nav-staff').style.display = 'none';
            document.getElementById('nav-backend').style.display = 'none';
            document.getElementById('nav-hr').style.display = 'none';
            document.getElementById('nav-admin').style.display = 'none';
        }

        // 顯示區塊
        function showSection(sectionId) {
            console.log('showSection called:', sectionId);
            console.log('currentUser:', currentUser);
            
            // 檢查權限
            if (sectionId !== 'home' && !currentUser) {
                showLoginModal();
                return;
            }
            
            if (sectionId !== 'home' && !canAccessSection(sectionId)) {
                showToast('danger', '權限不足', '您沒有權限存取此區塊');
                return;
            }
            
            // 隱藏所有區塊
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // 顯示指定區塊
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
            }
        }

        // 檢查區塊存取權限
        function canAccessSection(sectionId) {
            if (!currentUser) return false;
            
            const sectionPermissions = {
                'student': ['student'],
                'staff': ['staff', 'backend'],
                'hr': ['hr'],
                'admin': ['admin']
            };
            
            const allowedSections = sectionPermissions[currentUser.userType] || [];
            return allowedSections.includes(sectionId);
        }

        // 顯示功能
        function showFeature(featureId) {
            console.log('showFeature called:', featureId);
            console.log('currentUser:', currentUser);
            
            if (!currentUser) {
                showLoginModal();
                return;
            }
            
            if (!canAccessFeature(featureId)) {
                showToast('danger', '權限不足', '您沒有權限使用此功能');
                return;
            }
            
            // 隱藏所有區塊
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // 顯示功能內容區
            document.getElementById('feature-content').style.display = 'block';
            
            // 載入功能內容
            loadFeatureContent(featureId);
        }

        // 檢查功能存取權限
        function canAccessFeature(featureId) {
            if (!currentUser) return false;
            
            const userPermissions = permissions[currentUser.userType] || [];
            return userPermissions.includes(featureId);
        }

        // 顯示 Toast 通知
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toast-container');
            const toastId = 'toast-' + Date.now();
            
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <strong>${title}</strong><br>${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // 自動移除 Toast
            toast.addEventListener('hidden.bs.toast', function () {
                toast.remove();
            });
        }

        // 登出功能
        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUI();
            showSection('home');
            showToast('info', '登出成功', '您已成功登出系統');
        }

        // 載入功能內容
        function loadFeatureContent(featureId) {
            const content = document.getElementById('dynamic-content');
            
            switch(featureId) {
                case 'student-info':
                    content.innerHTML = `
                        <h4>學生基本資料查詢</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>姓名:</strong> ${currentUser.name}</p>
                                <p><strong>學號:</strong> ${currentUser.username}</p>
                                <p><strong>系所:</strong> 資訊工程系</p>
                                <p><strong>年級:</strong> 二年級</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>狀態:</strong> 在學</p>
                                <p><strong>Email:</strong> ${currentUser.username}@student.edu.tw</p>
                                <p><strong>電話:</strong> 0912-345-678</p>
                                <p><strong>地址:</strong> 台北市大安區</p>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'student-schedule':
                    showScheduleInfo();
                    break;
                    
                case 'student-grades':
                    showGradesInfo();
                    break;

                case 'student-enrollment':
                    showEnrollmentInfo();
                    break;

                case 'student-fees':
                    showFeesInfo();
                    break;

                case 'student-activities':
                    showActivitiesInfo();
                    break;

                // 教職員功能
                case 'staff-info':
                    content.innerHTML = `
                        <h4>教職員基本資料查詢</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>姓名:</strong> ${currentUser.name}</p>
                                <p><strong>職員編號:</strong> ${currentUser.username}</p>
                                <p><strong>部門:</strong> 資訊工程系</p>
                                <p><strong>職稱:</strong> 助理教授</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Email:</strong> ${currentUser.username}@staff.edu.tw</p>
                                <p><strong>分機:</strong> 2345</p>
                                <p><strong>辦公室:</strong> 資訊大樓 305</p>
                                <p><strong>到職日:</strong> 2020/08/01</p>
                            </div>
                        </div>
                    `;
                    break;

                case 'staff-grades':
                    content.innerHTML = `
                        <h4>成績登錄</h4>
                        <p>成績登錄功能正在開發中...</p>
                    `;
                    break;

                case 'staff-schedule':
                    content.innerHTML = `
                        <h4>授課課表查詢</h4>
                        <p>授課課表查詢功能正在開發中...</p>
                    `;
                    break;

                case 'staff-finance':
                    content.innerHTML = `
                        <h4>財務紀錄查詢</h4>
                        <p>財務紀錄查詢功能正在開發中...</p>
                    `;
                    break;

                case 'staff-activities':
                    content.innerHTML = `
                        <h4>教職員活動報名</h4>
                        <p>教職員活動報名功能正在開發中...</p>
                    `;
                    break;

                // 後台功能
                case 'backend-students':
                    content.innerHTML = `
                        <h4>學生資料查詢</h4>
                        <p>學生資料查詢功能正在開發中...</p>
                    `;
                    break;

                case 'backend-courses':
                    content.innerHTML = `
                        <h4>課程管理</h4>
                        <p>課程管理功能正在開發中...</p>
                    `;
                    break;

                case 'backend-stats':
                    content.innerHTML = `
                        <h4>成績統計</h4>
                        <p>成績統計功能正在開發中...</p>
                    `;
                    break;

                // 人事部功能
                case 'hr-staff':
                    content.innerHTML = `
                        <h4>教職員資料查詢</h4>
                        <p>教職員資料查詢功能正在開發中...</p>
                    `;
                    break;

                case 'hr-attendance':
                    content.innerHTML = `
                        <h4>出勤管理</h4>
                        <p>出勤管理功能正在開發中...</p>
                    `;
                    break;

                case 'hr-calendar':
                    content.innerHTML = `
                        <h4>行事曆與考績查詢</h4>
                        <p>行事曆與考績查詢功能正在開發中...</p>
                    `;
                    break;

                case 'hr-announcements':
                    content.innerHTML = `
                        <h4>公告發布</h4>
                        <p>公告發布功能正在開發中...</p>
                    `;
                    break;

                // 系統管理功能
                case 'admin-users':
                    content.innerHTML = `
                        <h4>使用者管理</h4>
                        <p>使用者管理功能正在開發中...</p>
                    `;
                    break;

                case 'admin-backup':
                    content.innerHTML = `
                        <h4>系統備份</h4>
                        <p>系統備份功能正在開發中...</p>
                    `;
                    break;

                case 'admin-logs':
                    content.innerHTML = `
                        <h4>系統日誌</h4>
                        <p>系統日誌功能正在開發中...</p>
                    `;
                    break;

                // 學生新功能
                case 'student-announcements':
                    content.innerHTML = `
                        <h4>公告通知</h4>
                        <div class="alert alert-info">
                            <strong>最新公告</strong><br>
                            期中考試將於下週舉行，請同學準備。
                        </div>
                        <div class="alert alert-warning">
                            <strong>重要通知</strong><br>
                            圖書館將於本週末進行系統維護。
                        </div>
                    `;
                    break;

                case 'student-documents':
                    content.innerHTML = `
                        <h4>文件申請</h4>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">在學證明</h5>
                                        <p class="card-text">申請在學證明書</p>
                                        <button class="btn btn-primary">申請</button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">成績單</h5>
                                        <p class="card-text">申請正式成績單</p>
                                        <button class="btn btn-primary">申請</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;

                case 'student-library':
                    content.innerHTML = `
                        <h4>圖書館系統</h4>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>書名</th>
                                    <th>借閱日期</th>
                                    <th>到期日期</th>
                                    <th>狀態</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>資料結構與演算法</td>
                                    <td>2024-01-15</td>
                                    <td>2024-02-15</td>
                                    <td><span class="badge bg-success">已歸還</span></td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                    break;

                case 'student-feedback':
                    content.innerHTML = `
                        <h4>意見反映</h4>
                        <form>
                            <div class="mb-3">
                                <label class="form-label">意見類型</label>
                                <select class="form-select">
                                    <option>教學建議</option>
                                    <option>設施改善</option>
                                    <option>其他</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">意見內容</label>
                                <textarea class="form-control" rows="4"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">提交</button>
                        </form>
                    `;
                    break;

                // 教職員新功能
                case 'staff-research':
                    content.innerHTML = `
                        <h4>研究計畫</h4>
                        <p>研究計畫申請與管理功能正在開發中...</p>
                    `;
                    break;

                case 'staff-office-hours':
                    content.innerHTML = `
                        <h4>Office Hours</h4>
                        <p>Office Hours 設定功能正在開發中...</p>
                    `;
                    break;

                case 'staff-resources':
                    content.innerHTML = `
                        <h4>資源申請</h4>
                        <p>資源申請功能正在開發中...</p>
                    `;
                    break;

                // 後台新功能
                case 'backend-student-edit':
                    content.innerHTML = `
                        <h4>學生資料異動</h4>
                        <p>學生資料異動功能正在開發中...</p>
                    `;
                    break;

                case 'backend-ranking':
                    content.innerHTML = `
                        <h4>全校排名</h4>
                        <p>全校排名功能正在開發中...</p>
                    `;
                    break;

                case 'backend-reports':
                    content.innerHTML = `
                        <h4>統計報表</h4>
                        <p>統計報表功能正在開發中...</p>
                    `;
                    break;

                case 'backend-enrollment':
                    content.innerHTML = `
                        <h4>選課管理</h4>
                        <p>選課管理功能正在開發中...</p>
                    `;
                    break;

                // 人事部新功能
                case 'hr-recruitment':
                    content.innerHTML = `
                        <h4>招聘管理</h4>
                        <p>招聘管理功能正在開發中...</p>
                    `;
                    break;

                case 'hr-training':
                    content.innerHTML = `
                        <h4>教育訓練</h4>
                        <p>教育訓練功能正在開發中...</p>
                    `;
                    break;

                case 'hr-performance':
                    content.innerHTML = `
                        <h4>績效考核</h4>
                        <p>績效考核功能正在開發中...</p>
                    `;
                    break;

                case 'hr-payroll':
                    content.innerHTML = `
                        <h4>薪資管理</h4>
                        <p>薪資管理功能正在開發中...</p>
                    `;
                    break;

                // 系統管理新功能
                case 'admin-roles':
                    content.innerHTML = `
                        <h4>角色權限</h4>
                        <p>角色權限管理功能正在開發中...</p>
                    `;
                    break;

                case 'admin-security':
                    content.innerHTML = `
                        <h4>安全設定</h4>
                        <p>安全設定功能正在開發中...</p>
                    `;
                    break;

                case 'admin-maintenance':
                    content.innerHTML = `
                        <h4>系統維護</h4>
                        <p>系統維護功能正在開發中...</p>
                    `;
                    break;

                case 'admin-monitoring':
                    content.innerHTML = `
                        <h4>系統監控</h4>
                        <p>系統監控功能正在開發中...</p>
                    `;
                    break;

                case 'admin-database':
                    content.innerHTML = `
                        <h4>資料庫管理</h4>
                        <p>資料庫管理功能正在開發中...</p>
                    `;
                    break;
                    
                default:
                    content.innerHTML = `
                        <h4>功能開發中</h4>
                        <p>此功能正在開發中，敬請期待...</p>
                    `;
            }
        }

        // 頁面載入時檢查登入狀態
        window.addEventListener('load', function() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUI();
            }
            
            // 預設顯示首頁
            showSection('home');
        });

        // 成績資訊顯示
        async function showGradesInfo() {
            const content = document.getElementById('dynamic-content');
            content.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">載入中...</span></div></div>';
            
            if (!currentUser || !currentUser.token) {
                content.innerHTML = '<div class="alert alert-warning">請先登入</div>';
                return;
            }
            
            try {
                const response = await fetch('/api/student/grades', {
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const data = result.data;
                    
                    content.innerHTML = `
                        <h4>成績查詢</h4>
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>學期成績</h5>
                                    </div>
                                    <div class="card-body">
                                        ${data.grades.length > 0 ? `
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>課程代碼</th>
                                                            <th>課程名稱</th>
                                                            <th>學分</th>
                                                            <th>成績</th>
                                                            <th>等第</th>
                                                            <th>GPA</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${data.grades.map(grade => `
                                                            <tr>
                                                                <td>${grade.courseId}</td>
                                                                <td>${grade.courseName}</td>
                                                                <td>${grade.credits}</td>
                                                                <td>${grade.score}</td>
                                                                <td>${grade.grade}</td>
                                                                <td>${grade.gpa}</td>
                                                            </tr>
                                                        `).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        ` : '<p class="text-muted">目前沒有成績資料</p>'}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>成績統計</h5>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>總學分：</strong> ${data.statistics.totalCredits}</p>
                                        <p><strong>平均GPA：</strong> ${data.statistics.averageGpa}</p>
                                        <p><strong>總成績：</strong> ${data.statistics.totalGrades}</p>
                                        <p><strong>平均成績：</strong> ${data.statistics.averageScore}</p>
                                        <div class="mt-3">
                                            <div class="progress">
                                                <div class="progress-bar ${data.statistics.averageGpa >= 3.5 ? 'bg-success' : data.statistics.averageGpa >= 2.5 ? 'bg-warning' : 'bg-danger'}" 
                                                     role="progressbar" 
                                                     style="width: ${(data.statistics.averageGpa / 4) * 100}%">
                                                    GPA ${data.statistics.averageGpa}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    content.innerHTML = '<div class="alert alert-danger">載入成績資訊失敗</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                content.innerHTML = '<div class="alert alert-danger">載入成績資訊時發生錯誤</div>';
            }
        }

        // 課程表資訊顯示
        async function showScheduleInfo() {
            const content = document.getElementById('dynamic-content');
            content.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">載入中...</span></div></div>';
            
            if (!currentUser || !currentUser.token) {
                content.innerHTML = '<div class="alert alert-warning">請先登入</div>';
                return;
            }
            
            try {
                const response = await fetch('/api/student/schedule', {
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const data = result.data;
                    
                    content.innerHTML = `
                        <h4>課表查詢</h4>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>本學期課程表</h5>
                                        <small class="text-muted">${data.semester} ${data.year}</small>
                                    </div>
                                    <div class="card-body">
                                        ${data.schedule.length > 0 ? `
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>課程代碼</th>
                                                            <th>課程名稱</th>
                                                            <th>學分</th>
                                                            <th>授課教師</th>
                                                            <th>上課時間</th>
                                                            <th>教室</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${data.schedule.map(course => `
                                                            <tr>
                                                                <td>${course.courseId}</td>
                                                                <td>${course.courseName}</td>
                                                                <td>${course.credits}</td>
                                                                <td>${course.instructor}</td>
                                                                <td>
                                                                    ${course.schedule.map(s => `${s.day} ${s.time}`).join('<br>')}
                                                                </td>
                                                                <td>
                                                                    ${course.schedule.map(s => s.room).join('<br>')}
                                                                </td>
                                                            </tr>
                                                        `).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="mt-3">
                                                <p><strong>總學分：</strong> ${data.totalCredits}</p>
                                            </div>
                                        ` : '<p class="text-muted">目前沒有課程資料</p>'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    content.innerHTML = '<div class="alert alert-danger">載入課程表失敗</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                content.innerHTML = '<div class="alert alert-danger">載入課程表時發生錯誤</div>';
            }
        }

        // 選課資訊顯示
        async function showEnrollmentInfo() {
            const content = document.getElementById('dynamic-content');
            content.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">載入中...</span></div></div>';
            
            if (!currentUser || !currentUser.token) {
                content.innerHTML = '<div class="alert alert-warning">請先登入</div>';
                return;
            }
            
            try {
                const response = await fetch('/api/student/enrollment', {
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const data = result.data;
                    
                    content.innerHTML = `
                        <h4>選課登記</h4>
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>已選課程</h5>
                                    </div>
                                    <div class="card-body">
                                        ${data.enrollments.length > 0 ? `
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>課程代碼</th>
                                                            <th>課程名稱</th>
                                                            <th>學分</th>
                                                            <th>授課教師</th>
                                                            <th>狀態</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${data.enrollments.map(enrollment => `
                                                            <tr>
                                                                <td>${enrollment.courseId}</td>
                                                                <td>${enrollment.courseName}</td>
                                                                <td>${enrollment.credits}</td>
                                                                <td>${enrollment.instructor}</td>
                                                                <td><span class="badge bg-success">已選</span></td>
                                                            </tr>
                                                        `).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        ` : '<p class="text-muted">目前沒有選課記錄</p>'}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>選課統計</h5>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>已選學分:</strong> ${data.statistics.totalCredits}</p>
                                        <p><strong>已選課程:</strong> ${data.statistics.totalCourses}</p>
                                        <p><strong>選課上限:</strong> 25</p>
                                        <div class="progress">
                                            <div class="progress-bar" role="progressbar" style="width: ${(data.statistics.totalCredits / 25) * 100}%">
                                                ${data.statistics.totalCredits}/25
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    content.innerHTML = '<div class="alert alert-danger">載入選課資訊失敗</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                content.innerHTML = '<div class="alert alert-danger">載入選課資訊時發生錯誤</div>';
            }
        }

        // 學費資訊顯示
        async function showFeesInfo() {
            const content = document.getElementById('dynamic-content');
            content.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">載入中...</span></div></div>';
            
            if (!currentUser || !currentUser.token) {
                content.innerHTML = '<div class="alert alert-warning">請先登入</div>';
                return;
            }
            
            try {
                const response = await fetch('/api/student/fees', {
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const data = result.data;
                    
                    content.innerHTML = `
                        <h4>學費查詢</h4>
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>學費明細</h5>
                                    </div>
                                    <div class="card-body">
                                        ${data.fees.length > 0 ? `
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>費用項目</th>
                                                            <th>金額</th>
                                                            <th>學期</th>
                                                            <th>繳費期限</th>
                                                            <th>狀態</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${data.fees.map(fee => `
                                                            <tr>
                                                                <td>${fee.feeType}</td>
                                                                <td>$${fee.totalAmount.toLocaleString()}</td>
                                                                <td>${fee.semester} ${fee.year}</td>
                                                                <td>${new Date(fee.dueDate).toLocaleDateString()}</td>
                                                                <td>
                                                                    <span class="badge ${fee.status === 'paid' ? 'bg-success' : 'bg-warning'}">
                                                                        ${fee.status === 'paid' ? '已繳' : '未繳'}
                                                                    </span>
                                                                </td>
                                                            </tr>
                                                        `).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        ` : '<p class="text-muted">目前沒有學費記錄</p>'}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>繳費統計</h5>
                                    </div>
                                    <div class="card-body">
                                        <p><strong>總金額:</strong> $${data.statistics.totalFees.toLocaleString()}</p>
                                        <p><strong>已繳金額:</strong> $${data.statistics.totalPaid.toLocaleString()}</p>
                                        <p><strong>未繳金額:</strong> $${data.statistics.totalOverdue.toLocaleString()}</p>
                                        ${data.statistics.totalOverdue > 0 ? `
                                            <div class="alert alert-warning">
                                                <i class="bi bi-exclamation-triangle"></i>
                                                您有未繳費用，請及時繳費
                                            </div>
                                        ` : `
                                            <div class="alert alert-success">
                                                <i class="bi bi-check-circle"></i>
                                                所有費用已繳清
                                            </div>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    content.innerHTML = '<div class="alert alert-danger">載入學費資訊失敗</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                content.innerHTML = '<div class="alert alert-danger">載入學費資訊時發生錯誤</div>';
            }
        }

        // 活動資訊顯示
        async function showActivitiesInfo() {
            const content = document.getElementById('dynamic-content');
            content.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">載入中...</span></div></div>';
            
            if (!currentUser || !currentUser.token) {
                content.innerHTML = '<div class="alert alert-warning">請先登入</div>';
                return;
            }
            
            try {
                const response = await fetch('/api/student/activities', {
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const data = result.data;
                    
                    content.innerHTML = `
                        <h4>活動報名</h4>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>可報名活動</h5>
                                    </div>
                                    <div class="card-body">
                                        ${data.activities.length > 0 ? `
                                            <div class="row">
                                                ${data.activities.map(activity => `
                                                    <div class="col-md-6 mb-3">
                                                        <div class="card">
                                                            <div class="card-body">
                                                                <h6 class="card-title">${activity.title}</h6>
                                                                <p class="card-text">${activity.description}</p>
                                                                <p class="text-muted small">
                                                                    <i class="bi bi-calendar"></i> ${new Date(activity.startDate).toLocaleDateString()}
                                                                    <br>
                                                                    <i class="bi bi-geo-alt"></i> ${activity.location}
                                                                    <br>
                                                                    <i class="bi bi-people"></i> ${activity.currentParticipants}/${activity.maxParticipants}
                                                                    <br>
                                                                    <i class="bi bi-tag"></i> ${activity.categoryName}
                                                                </p>
                                                                <span class="badge ${activity.status === 'registration_open' ? 'bg-success' : 'bg-secondary'}">
                                                                    ${activity.statusName}
                                                                </span>
                                                                ${activity.canRegister ? `
                                                                    <button class="btn btn-primary btn-sm ms-2" onclick="registerActivity('${activity.activityId}')">
                                                                        報名
                                                                    </button>
                                                                ` : activity.isRegistered ? `
                                                                    <span class="badge bg-info ms-2">已報名</span>
                                                                ` : `
                                                                    <span class="text-muted ms-2 small">${activity.registrationReason}</span>
                                                                `}
                                                            </div>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        ` : '<p class="text-muted">目前沒有可報名的活動</p>'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    content.innerHTML = '<div class="alert alert-danger">載入活動資訊失敗</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                content.innerHTML = '<div class="alert alert-danger">載入活動資訊時發生錯誤</div>';
            }
        }

        // 活動報名函數
        async function registerActivity(activityId) {
            if (!currentUser || !currentUser.token) {
                showToast('warning', '請先登入', '請先登入後再進行報名');
                return;
            }
            
            try {
                const response = await fetch(`/api/student/activities/${activityId}/register`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentUser.token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showToast('success', '報名成功！', '您已成功報名此活動');
                    // 重新載入活動資訊
                    showActivitiesInfo();
                } else {
                    showToast('danger', '報名失敗', result.message || '報名失敗');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('danger', '報名失敗', '報名時發生錯誤');
            }
        }

        // 頁面載入完成後初始化
        updateUI();
        });
    </script>
</body>
</html>
